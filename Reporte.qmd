---
lang: es
format:
  html:
    embed-resources: true
    published-title: "Fecha:"  # Cambia "Published" por "Fecha"
    title: "UNIDAD CENTINELA DE INFECCION RESPIRATORIA AGUDA GRAVE (IRAG)"
    author-title: "Autor: UCIRAG TUCUMAN / SALTA"
    toc: true                # Habilita la tabla de contenidos
    toc-title: "Índice de Contenidos"  # Título del índice
    toc-depth: 3             # Nivel de profundidad del índice (hasta h3)
    toc-location: left       # Ubicación del índice (izquierda)
    include-in-header: logo.html
    css: estilologo.css
link-citations: true
editor: visual
execute:
  warning: false
  message: false
footnotes-hover: true # muestra notas al pie
smooth-scroll: true # suaviza el scroll
code-copy: true            # Permite copiar el código desde el documento
---

```{r}
#| label: Preparacion de base de datos - UCIRAG
#| echo: false
#| message: false
#| warning: false
# -------LIBRERIAS-----------

library(dplyr)
library(ggplot2)
library(lubridate)
library(stringr)
library(readxl)
library(writexl)
library(readr)
library(gt)

if (requireNamespace("extrafont", quietly = TRUE)) {
  library(extrafont)
} else {
  message("Paquete 'extrafont' no disponible, se omite su carga.")
}

library(leaflet)
library(geoAr)
library(highcharter)
library(tidyr)

# --------IMPORTAR BASE---------

# dfnom <- read_excel("data/Base_UC_IRAG.xlsx")

dfnom <- read_excel("data/Base _UC_IRAG.xlsx")

# readxl::read_excel("data/Base_UC_IRAG.xlsx")


# ------CONSIDERACIONES----------

#DEBO CREAR PRIMERO UNA BASE QUE NO CONTENGA LOS CASOS INVALIDADOS 
# DEBO CREAR UN NUEVO OBJETO PARA ORDENAR LOS GRUPOS DE EDAD
# LAS VARIABKE SA USAR SERAN:
# CLASIFICACION MANUAL DE CASO
# EDAD_UC_IRAG

# -----CREACION DE LA NUEVA BASE LIMPIA-------

base_limpia <- dfnom %>%
  dplyr::filter(CLASIFICACION_MANUAL != "Caso invalidado por epidemiología")

notti <- base_limpia %>% mutate( GRUPO_ETARIO= case_when( EDAD_UC_IRAG == "0 a 2 Meses" | EDAD_UC_IRAG == "3 a 5 Meses" ~ "Menor a 6 Meses",
                                                    EDAD_UC_IRAG == "6 a 11 Meses"| EDAD_UC_IRAG == "12 a 23 Meses" ~ "6 a 23 Meses ",
                                                    TRUE ~ EDAD_UC_IRAG ))
   
```

# Introducción

Las infecciones respiratorias agudas (IRAs) constituyen una importante causa de morbimortalidad afectando fundamentalmente a niñas/os menores de cinco años, particularmente aquellos menores de 2 años, adultos mayores y personas susceptibles con patologías de base (cardiovascular, respiratoria, inmunosupresión, entre otras).

En Argentina, todos los años se verifica un progresivo aumento de los casos de IRAs en la época invernal. Dicho aumento se asocia con un incremento en la demanda de atención, del número de hospitalizaciones y de la mortalidad por causas respiratorias. 

Las infecciones respiratorias emergentes representan un riesgo importante para la población en virtud de su elevado potencial de transmisión de persona a persona.

Actualmente en la provincia de Tucumán se desarrollan diferentes estrategias de vigilancia epidemiológica de IRAs. La vigilancia epidemiológica sistemática de las infecciones respiratorias agudas graves (IRAG) es fundamental para la caracterización de la situación epidemiológica, detección de eventos inusuales y la implementación oportuna de las medidas de promoción, prevención y control, fortaleciendo la capacidad de respuesta de los servicios de atención y del sector salud en su conjunto.

La Organización Mundial de la Salud recomienda la implementación de sistemas de vigilancia centinela de hospitalizaciones por IRAG (UC-IRAG) que integran la vigilancia de virus respiratorios con potencial epidémico y pandémico: SARS-CoV-2, influenza y virus sincitial respiratorio (VSR). La UC-IRAG en casos hospitalizados se complementa con la vigilancia centinela de estos tres virus en ambulatorios a través de las Unidades de Monitoreo Ambulatorio (UMAs) y ambas permiten caracterizar el espectro de severidad de las infecciones respiratorias agudas de manera integrada.

## Objetivo General

Describir el perfil clínico, epidemiológico y de diagnóstico etiológico de las infecciones respiratorias agudas graves (IRAG) notificadas a través de la estrategia de unidad centinela del Hospital Avellaneda durante el período comprendido entre la SE 18 del 2024 y la SE 30 del 2025

## Ubicación geográfica

```{r}
#| label: Ubicacion UCIRAG 
#| echo: false
#| message: false 
#| warning: false 
#|  


LISTADO_EFECTORES <- read_excel("EFECTORES.xlsx")
# Separar coordenadas en latitud y longitud
LISTADO_EFECTORES <- LISTADO_EFECTORES %>%
  mutate(
    lat = as.numeric(sub(",.*", "", Coordenadas)),
    lon = as.numeric(sub(".*,", "", Coordenadas))
  )

# Crear mapa base
mapa_efectores <- leaflet() %>%
  addArgTiles()

# Agregar hospitales (azules)
mapa_efectores <- mapa_efectores %>%
  addCircleMarkers(
    data = LISTADO_EFECTORES %>% dplyr::filter(`tipo de establecimiento` == "HOSPITAL"),
    ~lon, ~lat,
    popup = ~paste0("<b>Nombre:</b> ", Nombre, "<br>",
                    "<b>Código SISA:</b> ", `Código SISA EFECTOR`, "<br>",
                    "<b>Nivel Complejidad:</b> ", `NIVEL COMPL`, "<br>",
                    "<b>Zona Sanitaria:</b> ", `zona sanitaria`, "<br>",
                    "<b>Localidad:</b> ", LOCALIDAD, "<br>",
                    "<b>Tipo de Establecimiento:</b> ", `tipo de establecimiento`, "<br>",
                    "<b>Estrategia:</b> ", Estrategia),
    color = "blue",
    radius = 5,
    fillOpacity = 0.7
  )

# Agregar laboratorios (verdes y más pequeños)
mapa_efectores <- mapa_efectores %>%
  addCircleMarkers(
    data = LISTADO_EFECTORES %>% dplyr::filter(`tipo de establecimiento` == "LABORATORIO"),
    ~lon, ~lat,
    popup = ~paste0("<b>Nombre:</b> ", Nombre, "<br>",
                    "<b>Código SISA:</b> ", `Código SISA EFECTOR`, "<br>",
                    "<b>Nivel Complejidad:</b> ", `NIVEL COMPL`, "<br>",
                    "<b>Zona Sanitaria:</b> ", `zona sanitaria`, "<br>",
                    "<b>Localidad:</b> ", LOCALIDAD, "<br>",
                    "<b>Tipo de Establecimiento:</b> ", `tipo de establecimiento`, "<br>",
                    "<b>Estrategia:</b> ", Estrategia),
    color = "#04cc97",
    radius = 3,  # Más pequeño
    fillOpacity = 1
  )

# Agregar otros establecimientos (naranja y gris)
mapa_efectores <- mapa_efectores %>%
  addCircleMarkers(
    data = LISTADO_EFECTORES %>% dplyr::filter(!`tipo de establecimiento` %in% c("HOSPITAL", "LABORATORIO")),
    ~lon, ~lat,
    popup = ~paste0("<b>Nombre:</b> ", Nombre, "<br>",
                    "<b>Código SISA:</b> ", `Código SISA EFECTOR`, "<br>",
                    "<b>Nivel Complejidad:</b> ", `NIVEL COMPL`, "<br>",
                    "<b>Zona Sanitaria:</b> ", `zona sanitaria`, "<br>",
                    "<b>Localidad:</b> ", LOCALIDAD, "<br>",
                    "<b>Tipo de Establecimiento:</b> ", `tipo de establecimiento`, "<br>",
                    "<b>Estrategia:</b> ", Estrategia),
    color = ~case_when(
      `tipo de establecimiento` == "CENTRO DE SALUD RURAL" ~ "orange",
      TRUE ~ "gray"
    ),
    radius = 5,
    fillOpacity = 0.7
  )

# Agregar los establecimientos centinela (cruces rojas)
mapa_efectores <- mapa_efectores %>%
  addAwesomeMarkers(
    data = LISTADO_EFECTORES %>% dplyr::filter(Estrategia == "CENTINELA"),
    ~lon, ~lat,
    popup = ~paste0("<b>Nombre:</b> ", Nombre, "<br>",
                    "<b>Código SISA:</b> ", `Código SISA EFECTOR`, "<br>",
                    "<b>Nivel Complejidad:</b> ", `NIVEL COMPL`, "<br>",
                    "<b>Zona Sanitaria:</b> ", `zona sanitaria`, "<br>",
                    "<b>Localidad:</b> ", LOCALIDAD, "<br>",
                    "<b>Tipo de Establecimiento:</b> ", `tipo de establecimiento`, "<br>",
                    "<b>Estrategia:</b> ", Estrategia),
    icon = awesomeIcons(
      icon = "plus",
      library = "fa",
      markerColor = "red"
    )
  )

# Agregar leyenda
# Leyenda personalizada con HTML
# Leyenda personalizada con HTML y cruz negra
custom_legend <- htmltools::HTML('
<div style="background:white; padding: 10px; border-radius: 5px; box-shadow: 2px 2px 6px rgba(0,0,0,0.3); font-size: 14px;">
  <b>Tipos de Establecimientos</b><br>
  <i style="background:blue; width: 12px; height: 12px; display:inline-block; border-radius:50%; margin-right:6px;"></i> Hospital<br>
  <i style="background:orange; width: 12px; height: 12px; display:inline-block; border-radius:50%; margin-right:6px;"></i> Centro de Salud Rural<br>
  <i style="background:#04cc97; width: 12px; height: 12px; display:inline-block; border-radius:50%; margin-right:6px;"></i> Laboratorio<br>
  <i style="background:gray; width: 12px; height: 12px; display:inline-block; border-radius:50%; margin-right:6px;"></i> Otro<br>
  <i class="fa fa-plus" style="color:black; background:#cc0415; border-radius: 50%; padding: 2px 5px; margin-right:6px;"></i> Unidad Centinela de IRAG
</div>
')

mapa_efectores <- mapa_efectores %>%
  addControl(custom_legend, position = "bottomright")

mapa_efectores

```

# Análisis de la UCIRAG de la Provincia de Tucumán

## Casos de IRAG e IRAG extendida segun Semana Epidemiológica - UC-IRAG Hospital Avellaneda -Año 2024 y 2025

```{r}
#| label: CASOS POR SE
#| message: false 
#| echo: false
#| warning: false

source("GRAFICO IRAG POR SE INTERACTVIO.R")
GRAFICO_INTERACTIVO_SE

```

## Casos de IRAG e IRAG extendida segun grupo etario - UC-IRAG Hospital Avellaneda - Año 2024 y 2025

```{r}
#| label: CASOS POR GRUPO DE EDAD
#| message: false 
#| echo: false
#| warning: false

source("GRAFICO IRAG POR GRUPO DE EDAD INTERACTIVO.R")
GRAFICO_INTERACTIVO_EDAD
```

## Casos de virus respiratorios por Semana Epidemiológica - UCIRAG Hospital Avellaneda - Tucumán - Año 2024 y 2025
```{r}
#| label: CASOS IRAG POR TIPO DE VIRUS Y SE
#| message: false 
#| echo: false
#| warning: false

source("GRAFICO IRAG CASOS POR TIPO DE VIRUS Y SE INTERACTIVO.R")
GRAFICO_INTERACTIVO_VIRUS
```


## Detecciones virales segun semana epidemiologica - UC-IRAG Hospital Avellaneda - Año 2024 y 2025

```{r}
#| label: Deteccion viral vs se- UCIRAG  
#| message: false 
#| warning: false  
#| echo: false
library(tidyr) 

# -------- CREACION DE LA VARIABLE LLAMADA: 'semana_continua'
base_limpia <- base_limpia %>%
  filter(!is.na(SEPI_FECHA_INTER), !is.na(ANIO_MIN_INTERNACION)) %>%
  mutate(
    semana_continua = case_when(
      ANIO_MIN_INTERNACION == 2024 ~ SEPI_FECHA_INTER,
      ANIO_MIN_INTERNACION == 2025 ~ SEPI_FECHA_INTER + 52
    )
  )

# ------ ELIMINAR LAS CATEGORIAS NEGATIVO Y SIN RESULTADO DE LAS VARIABLES 
# VRS, INFLUENZA Y COVID---------------------------------------------------

base_virus <- base_limpia %>%
  select(semana_continua, INFLUENZA_FINAL, VSR_FINAL, COVID_19_FINAL) %>%
  mutate(
    COVID_19_FINAL = ifelse(COVID_19_FINAL == "Positivo", "Positivo COVID", COVID_19_FINAL)
  ) %>%
  pivot_longer(
    cols = c(INFLUENZA_FINAL, VSR_FINAL, COVID_19_FINAL),
    names_to = "virus_tipo",
    values_to = "virus_resultado"
  ) %>%
  filter(
    !virus_resultado %in% c("Negativo", "Sin resultado"),
    !is.na(semana_continua)
  )

# ----- GRAFICO DE DETERMINACIONES VS SE------------------------------
ggplot(base_virus, aes(x = semana_continua, fill = virus_resultado)) +
  geom_bar(position = "stack") +
  labs(
    title = "Detecciones virales por semana epidemiológica",
    x = "Semana epidemiológica",
    y = "Número de casos",
    fill = "Resultado viral"
  ) +
  scale_fill_brewer(palette = "Set2") +
  scale_x_continuous(
    breaks = seq(min(base_virus$semana_continua, na.rm = TRUE),
                 max(base_virus$semana_continua, na.rm = TRUE),
                 by = 1),
    labels = function(x) {
      ifelse(x <= 52, paste0("2024-S", x), paste0("2025-S", x - 52))
    }
  ) +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 90, hjust = 1, size = 8),
    plot.title = element_text(face = "bold", hjust = 0.5),
    legend.position = "top"
  )

```

## Detecciones virales segun grupo etario - UC-IRAG Hospital Avellaneda - Año 2024 y 2025

```{r}
#| label: Detecciones vs edad - UCIRAG
#| echo: false
#| message: false
#| warning: false

# ------CONSIDERACIONES----------

#DEBO CREAR PRIMERO UNA BASE QUE NO CONTENGA LOS CASOS INVALIDADOS 
# DEBO CREAR UN NUEVO OBJETO PARA ORDENAR LOS GRUPOS DE EDAD
# LAS VARIABKE SA USAR SERAN:
# CLASIFICACION MANUAL DE CASO
# EDAD_UC_IRAG


# -----Ordenar los grupos etarios------

orden_edades <- c(
  "0 a 2 Meses", "3 a 5 Meses", "6 a 11 Meses", "12 a 23 Meses",
  "02 a 04 Años", "05 a 09 Años", "10 a 14 Años", "15 a 19 Años",
  "20 a 24 Años", "25 a 29 Años", "30 a 34 Años", "35 a 39 Años",
  "40 a 44 Años", "45 a 49 Años", "50 a 54 Años", "55 a 59 Años",
  "60 a 64 Años", "65 a 69 Años", "70 a 74 Años", "75 y más Años"
)

base_limpia$EDAD_UC_IRAG <- factor(
  base_limpia$EDAD_UC_IRAG,
  levels = orden_edades,
  ordered = TRUE
)

# ------Preparar los datos virales positivos-----------

base_virus_edad <- base_limpia %>%
  select(EDAD_UC_IRAG, INFLUENZA_FINAL, VSR_FINAL, COVID_19_FINAL) %>%
  mutate(
    COVID_19_FINAL = ifelse(COVID_19_FINAL == "Positivo", "Positivo COVID", COVID_19_FINAL)
  ) %>%
  pivot_longer(
    cols = c(INFLUENZA_FINAL, VSR_FINAL, COVID_19_FINAL),
    names_to = "virus_tipo",
    values_to = "virus_resultado"
  ) %>%
  filter(
    !virus_resultado %in% c("Negativo", "Sin resultado"),
    !is.na(EDAD_UC_IRAG)
  )

# ------- Crear el gráfico de barras apiladas-------------

ggplot(base_virus_edad, aes(x = EDAD_UC_IRAG, fill = virus_resultado)) +
  geom_bar(position = "stack") +
  labs(
    title = "Detecciones virales positivas por grupo etario",
    x = "Grupo etario",
    y = "Número de casos",
    fill = "Resultado viral"
  ) +
  scale_fill_brewer(palette = "Set2") +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),
    plot.title = element_text(face = "bold", hjust = 0.5),
    legend.position = "top"
  )

```

# **Difusión de la información**

A través de la notificación al SNVS 2.0 la información está al alcance del nivel provincial y nacional. Es importante que la unidad centinela difunda a los actores participantes de la estrategia los resultados de la vigilancia.

A nivel provincial la información es transmitida mediante un informe de vigilancia local trimestral, y a través de la Sala de Situación Provincial y el Boletín Epidemiológico Semanal. La periodicidad de estos métodos de difusión de la información podría variar según la situación epidemiológica vigente.
